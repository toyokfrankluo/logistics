{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
    <h2>è¿å•ç®¡ç†</h2>

    <!-- æœç´¢æ¡† -->
    <div class="mb-3">
        <form method="get" action="{{ url_for('views.shipments') }}" class="form-inline">
            <input type="text" name="customer" class="form-control mr-2" placeholder="æŒ‰å®¢æˆ·æŸ¥è¯¢" value="{{ request.args.get('customer', '') }}">
            <input type="text" name="agent" class="form-control mr-2" placeholder="æŒ‰ä»£ç†æŸ¥è¯¢" value="{{ request.args.get('agent', '') }}">
            <input type="text" name="tracking_number" class="form-control mr-2" placeholder="æŒ‰è¿å•å·æœç´¢" value="{{ request.args.get('tracking_number', '') }}">
            <button type="submit" class="btn btn-secondary">æœç´¢</button>
            <a href="{{ url_for('views.shipments') }}" class="btn btn-light ml-2">é‡ç½®</a>
        </form>
    </div>

    <!-- æ“ä½œæŒ‰é’®åŒºåŸŸ -->
    <div class="mb-3">
        <a href="{{ url_for('views.add_shipment') }}" class="btn btn-primary">æ–°å¢è¿å•</a>
        <a href="{{ url_for('views.refresh_tracking') }}" 
           class="btn btn-warning"
           onclick="return confirm('ç¡®å®šè¦åˆ·æ–°æ‰€æœ‰è¿å•çš„ç‰©æµè½¨è¿¹å—ï¼Ÿè¿™å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ã€‚')">
            ğŸ”„ ä¸€é”®åˆ·æ–°æ‰€æœ‰ç‰©æµè½¨è¿¹
        </a>
        <a href="{{ url_for('views.auto_sync_all_safe') }}" 
           class="btn btn-success"
           onclick="return confirm('ç¡®å®šè¦å®‰å…¨åŒæ­¥æ‰€æœ‰è¿å•å—ï¼Ÿè¿™ä¼šå®‰å…¨åœ°æ›´æ–°æ‰€æœ‰è¿å•çš„å®Œæ•´è½¨è¿¹ã€‚')">
            ğŸ›¡ï¸ å®‰å…¨åŒæ­¥æ‰€æœ‰è¿å•
        </a>
        <a href="{{ url_for('views.auto_sync_all') }}" 
           class="btn btn-success"
           onclick="return confirm('ç¡®å®šè¦è‡ªåŠ¨åŒæ­¥æ‰€æœ‰è¿å•å—ï¼Ÿè¿™ä¼šæ›´æ–°æ‰€æœ‰è¿å•çš„å®Œæ•´è½¨è¿¹ã€‚')">
            ğŸ¤– è‡ªåŠ¨åŒæ­¥æ‰€æœ‰è¿å•
        </a>
        <a href="{{ url_for('views.auto_sync_recent') }}" 
           class="btn btn-info"
           onclick="return confirm('ç¡®å®šè¦è‡ªåŠ¨åŒæ­¥æœ€è¿‘è¿å•å—ï¼Ÿè¿™ä¼šæ›´æ–°æœ€è¿‘7å¤©çš„è¿å•å®Œæ•´è½¨è¿¹ã€‚')">
            âš¡ è‡ªåŠ¨åŒæ­¥æœ€è¿‘è¿å•
        </a>
    </div>

    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>è¿å•å·</th>
                <th>ä»£ç†å•å·</th>
                <th>17Trackå•å·</th>
                <th>å®¢æˆ·</th>
                <th>ä»£ç†</th>
                <th>æ¸ é“</th>
                <th>é‡é‡</th>
                <th>è´¹ç”¨</th>
                <th>çŠ¶æ€</th>
                <th>æ“ä½œ</th>
            </tr>
        </thead>
        <tbody>
            {% for shipment in shipments %}
            <tr>
                <td>{{ shipment.id }}</td>
                <td>{{ shipment.tracking_number }}</td>
                <td>{{ shipment.agent_tracking_number if shipment.agent_tracking_number else '' }}</td>
                <td>{{ shipment.third_party_tracking_number if shipment.third_party_tracking_number else '' }}</td>
                <td>{{ shipment.customer.name if shipment.customer else '' }}</td>
                <td>{{ shipment.agent.name if shipment.agent else '' }}</td>
                <td>{{ shipment.channel }}</td>
                <td>{{ shipment.weight }}</td>
                <td>{{ "%.2f"|format(shipment.fee) if shipment.fee else "0.00" }}</td>
                <td>{{ shipment.status }}</td>
                <td>
                    <!-- åŒæ­¥å•ä¸ªè¿å•æŒ‰é’® -->
                    <a href="{{ url_for('views.auto_sync_single', shipment_id=shipment.id) }}" 
                       class="btn btn-sm btn-success mb-1"
                       onclick="return confirm('ç¡®å®šè¦åŒæ­¥è¯¥è¿å•çš„å®Œæ•´ç‰©æµè½¨è¿¹å—ï¼Ÿ')">
                        ğŸ¤– åŒæ­¥è¿å•
                    </a>

                    <!-- å¼ºåˆ¶åˆ·æ–°å®Œæ•´å†å²æŒ‰é’® -->
                    <a href="{{ url_for('views.refresh_full_history', shipment_id=shipment.id) }}" 
                       class="btn btn-sm btn-info mb-1"
                       onclick="return confirm('ç¡®å®šè¦å¼ºåˆ¶åˆ·æ–°å®Œæ•´å†å²è½¨è¿¹å—ï¼Ÿè¿™å°†è·å–å¹¶ä¿å­˜æ‰€æœ‰å†å²ç‰©æµæ•°æ®ï¼ŒåŒ…æ‹¬ä¹‹å‰ç¼ºå¤±çš„è½¨è¿¹ã€‚')">
                        ğŸ“œ åˆ·æ–°å®Œæ•´å†å²
                    </a>

                    <!-- åˆ·æ–°è½¨è¿¹æŒ‰é’® -->
                    <a href="{{ url_for('views.refresh_single_tracking', shipment_id=shipment.id) }}" 
                       class="btn btn-sm btn-warning mb-1"
                       onclick="return confirm('ç¡®å®šè¦åˆ·æ–°è¯¥è¿å•çš„ç‰©æµè½¨è¿¹å—ï¼Ÿ')">
                        ğŸ”„ åˆ·æ–°è½¨è¿¹
                    </a>

                    <!-- ç¼–è¾‘ -->
                    <a href="{{ url_for('views.edit_shipment', shipment_id=shipment.id) }}" 
                       class="btn btn-sm btn-warning mb-1">ç¼–è¾‘</a>

                    <!-- åˆ é™¤ -->
                    <form method="POST" action="{{ url_for('views.delete_shipment', shipment_id=shipment.id) }}" 
                          style="display:inline;">
                        <button type="submit" class="btn btn-sm btn-danger mb-1" 
                                onclick="return confirm('ç¡®å®šåˆ é™¤è¯¥è¿å•å—ï¼Ÿ')">åˆ é™¤</button>
                    </form>

                    <!-- æ‰‹å·¥è½¨è¿¹ -->
                    <a href="{{ url_for('views.manual_tracks', shipment_id=shipment.id) }}" 
                       class="btn btn-sm btn-secondary mb-1">æ‰‹å·¥è½¨è¿¹</a>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="11" class="text-center">æš‚æ— è¿å•</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}