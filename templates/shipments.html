{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
    <h2>运单管理</h2>
    <a href="{{ url_for('views.add_shipment') }}" class="btn btn-primary mb-3">新增运单</a>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>运单号</th>
                <th>客户</th>
                <th>代理</th>
                <th>渠道</th>
                <th>重量</th>
                <th>费用</th>
                <th>状态</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>
            {% for shipment in shipments %}
            <tr>
                <td>{{ shipment.id }}</td>
                <td>{{ shipment.tracking_number }}</td>
                <td>{{ shipment.customer.name if shipment.customer else '' }}</td>
                <td>{{ shipment.agent.name if shipment.agent else '' }}</td>
                <td>{{ shipment.channel }}</td>
                <td>{{ shipment.weight }}</td>
                <td>{{ "%.2f"|format(shipment.fee) if shipment.fee else "0.00" }}</td>
                <td>{{ shipment.status }}</td>
                <td>
                    <!-- 编辑 -->
                    <a href="{{ url_for('views.edit_shipment', shipment_id=shipment.id) }}" 
                       class="btn btn-sm btn-warning">编辑</a>

                    <!-- 删除 -->
                    <form method="POST" action="{{ url_for('views.delete_shipment', shipment_id=shipment.id) }}" 
                          style="display:inline;">
                        <button type="submit" class="btn btn-sm btn-danger" 
                                onclick="return confirm('确定删除该运单吗？')">删除</button>
                    </form>

                    <!-- 手工轨迹 -->
                    <a href="{{ url_for('views.manual_tracks', shipment_id=shipment.id) }}" 
                       class="btn btn-sm btn-info">手工轨迹</a>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="9" class="text-center">暂无运单</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}