{% extends "base.html" %}
{% block content %}
<h2>代理管理</h2>

{% if edit_agent %}
<form method="post" action="{{ url_for('edit_agent', id=edit_agent.id) }}">
  <h4>编辑代理：{{ edit_agent.name }}</h4>
{% else %}
<form method="post" action="{{ url_for('agents') }}">
  <h4>新增代理</h4>
{% endif %}
  <div class="row g-3">
    <div class="col-md-3">
      <label>代理名称</label>
      <input name="name" class="form-control" value="{{ edit_agent.name if edit_agent else '' }}" required>
    </div>
    <div class="col-md-5">
      <label>API 地址</label>
      <input name="api_url" class="form-control" value="{{ edit_agent.api_url if edit_agent else '' }}">
    </div>
    <div class="col-md-2">
      <label>账号</label>
      <input name="username" class="form-control" value="{{ edit_agent.username if edit_agent else '' }}">
    </div>
    <div class="col-md-2">
      <label>密码</label>
      <input name="password" class="form-control" type="password" value="">
    </div>
  </div>

  <div class="row g-3 mt-1">
    <div class="col-md-4">
      <label>appKey</label>
      <input name="app_key" class="form-control" value="{{ edit_agent.app_key if edit_agent else '' }}">
    </div>
    <div class="col-md-4">
      <label>appToken</label>
      <input name="app_token" class="form-control" value="{{ edit_agent.app_token if edit_agent else '' }}">
    </div>
    <div class="col-md-3">
      <label>客户号（可选）</label>
      <input name="customer_code" class="form-control" value="{{ edit_agent.customer_code if edit_agent else '' }}">
    </div>
    <div class="col-md-1">
      <label>支持抓取</label>
      <select name="supports_api" class="form-select">
        <option value="1" {% if edit_agent and edit_agent.supports_api %}selected{% endif %}>是</option>
        <option value="0" {% if edit_agent and not edit_agent.supports_api %}selected{% endif %}>否</option>
      </select>
    </div>
  </div>

  <div class="mt-3">
    <button class="btn btn-primary">保存代理</button>
    {% if edit_agent %}
      <a class="btn btn-secondary" href="{{ url_for('agents') }}">取消</a>
    {% endif %}
  </div>
</form>

<hr>
<h3>代理列表</h3>
<ul>
  {% for a in agents %}
    <li>
      <strong>{{ a.name }}</strong> — {{ a.api_url or '（未设置 API）' }}
      {% if a.app_key or a.app_token %} <span class="text-muted">（已配置 Key/Token）</span>{% endif %}
      <form style="display:inline" method="post" action="{{ url_for('delete_agent', id=a.id) }}">
        <button class="btn btn-sm btn-danger">删除</button>
      </form>
      <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('edit_agent', id=a.id) }}">编辑</a>
    </li>
  {% else %}
    <li>暂无代理</li>
  {% endfor %}
</ul>
{% endblock %}